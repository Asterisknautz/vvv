:root{
  --bg:#191925;
  --fg:#e6e6f6;
  --sub:#9aa3ff;
}
*{ box-sizing:border-box; }
html,body,#app{ height:100%; margin:0; }
body{ background:var(--bg); color:var(--fg); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans JP, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
#three-canvas{
  position:fixed; inset:0; width:100%; height:100%; display:block;
  transition: transform .18s ease, filter .18s ease;
  will-change: transform, filter;
}

#transition-stage{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:32;
  display:none;
}

#transition-stage.active{
  display:block;
}

#transition-stage > *{
  position:absolute;
  inset:0;
}

#transition-filters{
  position:absolute;
  width:0;
  height:0;
  pointer-events:none;
  opacity:0;
}

#scene-fade{
  position:fixed; inset:0;
  background:#000;
  opacity:0;
  pointer-events:none;
  transition: opacity .45s ease;
  z-index:20;
}

#scene-fade.visible{ opacity:1; }

#three-canvas.glitching{
  transform: translate(var(--glitch-translate-x, 0px), var(--glitch-translate-y, 0px)) skewX(var(--glitch-skew, 0deg));
  filter: saturate(1.2) contrast(1.08);
}

.pixel-shift{
  position:fixed; inset:0; pointer-events:none;
  mix-blend-mode:screen;
  background:repeating-linear-gradient(0deg, rgba(154,163,255,.22) 0 2px, transparent 2px 4px);
  opacity:0;
}

.pixel-shift.animate{
  animation:pixelShift .22s ease-out forwards;
}

@keyframes pixelShift{
  0%{
    opacity:.42;
    transform:translate(var(--shift-x, 0px), var(--shift-y, 0px));
    filter:hue-rotate(var(--shift-hue, 0deg)) saturate(1.5);
  }
  60%{
    opacity:.2;
    transform:translate(calc(var(--shift-x, 0px) * -.25), calc(var(--shift-y, 0px) * -.25));
  }
  100%{
    opacity:0;
    transform:translate(0,0);
    filter:hue-rotate(0deg) saturate(1);
  }
}

.site-brand{
  position:fixed; top:24px; left:24px; line-height:1;
  mix-blend-mode:screen; user-select:none; pointer-events:none;
}
.site-brand h1{
  margin:0; font-weight:800; letter-spacing:0.5px; font-size: clamp(20px, 2.8vw, 40px);
}
.site-brand h1 span{ color:var(--sub); }
#route-indicator{
  margin-top:6px; opacity:.7; font-size:12px; letter-spacing:1.5px;
}

.ui{
  position:fixed; top:24px; right:24px; display:flex; gap:12px;
  background:rgba(255,255,255,.05); backdrop-filter: blur(6px);
  padding:8px 10px; border-radius:10px;
}
.ui a{
  color:var(--fg); text-decoration:none; opacity:.8;
}
.ui a:hover{ opacity:1; text-decoration:underline; }

.hint{
  position:fixed; bottom:16px; left:50%; transform:translateX(-50%);
  font-size:12px; opacity:.6; background:rgba(0,0,0,.25); padding:6px 10px; border-radius:8px;
}

.transition-pixel-drift{
  background:#04020a;
  overflow:hidden;
}

.transition-pixel-drift .channel{
  position:absolute;
  inset:-6%;
  background-position:center;
  background-size:cover;
  opacity:.95;
  animation-duration:var(--drift-duration, .68s);
  animation-fill-mode:forwards;
  animation-timing-function:cubic-bezier(.17,.95,.42,1.01);
}

.transition-pixel-drift .channel.base{
  animation-name:pixelDriftBase;
}

.transition-pixel-drift .channel.red{
  mix-blend-mode:screen;
  filter:hue-rotate(12deg) saturate(1.5);
  animation-name:pixelDriftRed;
}

.transition-pixel-drift .channel.blue{
  mix-blend-mode:screen;
  filter:hue-rotate(-14deg) saturate(1.4);
  animation-name:pixelDriftBlue;
}

.transition-pixel-drift .channel.green{
  mix-blend-mode:screen;
  filter:hue-rotate(65deg) saturate(1.4);
  animation-name:pixelDriftGreen;
}

.transition-pixel-drift::after{
  content:"";
  position:absolute;
  inset:0;
  background:repeating-linear-gradient(0deg, rgba(10,12,36,.55) 0 2px, rgba(8,7,20,.1) 2px 4px);
  mix-blend-mode:screen;
  opacity:.25;
  animation:pixelScan var(--drift-duration, .68s) ease-out;
}

@keyframes pixelDriftBase{
  0%{ transform:translate(0,0); opacity:.98; }
  45%{ transform:translate(calc(var(--drift-x, 22px)*.35), calc(var(--drift-y, -16px)*.35)) skewX(calc(var(--drift-skew, 6deg)*.4)); }
  100%{ transform:translate(calc(var(--drift-x, 22px)*.6), calc(var(--drift-y, -16px)*.6)) skewX(var(--drift-skew, 6deg)); opacity:0; filter:contrast(.75); }
}

@keyframes pixelDriftRed{
  0%{ transform:translate(0,0); opacity:.8; }
  35%{ transform:translate(calc(var(--drift-x, 22px)*.8), calc(var(--drift-y, -16px)*.8)); opacity:1; }
  100%{ transform:translate(calc(var(--drift-x, 22px)*1.4), calc(var(--drift-y, -16px)*1.4)); opacity:0; filter:blur(1px); }
}

@keyframes pixelDriftGreen{
  0%{ transform:translate(0,0); opacity:.7; }
  40%{ transform:translate(calc(var(--drift-x, 22px)*-.4), calc(var(--drift-y, -16px)*-.4)); opacity:1; }
  100%{ transform:translate(calc(var(--drift-x, 22px)*-.9), calc(var(--drift-y, -16px)*-.9)); opacity:0; filter:blur(1.6px); }
}

@keyframes pixelDriftBlue{
  0%{ transform:translate(0,0); opacity:.65; }
  50%{ transform:translate(calc(var(--drift-x, 22px)*.5), calc(var(--drift-y, -16px)*-.35)); opacity:.9; }
  100%{ transform:translate(calc(var(--drift-x, 22px)*1.05), calc(var(--drift-y, -16px)*-.75)); opacity:0; filter:blur(1.3px); }
}

@keyframes pixelScan{
  0%{ opacity:.4; transform:translateY(-12%); }
  60%{ opacity:.15; transform:translateY(12%); }
  100%{ opacity:0; transform:translateY(24%); }
}

.transition-luminance{
  background:#000;
  display:flex;
  align-items:center;
  justify-content:center;
}

.transition-luminance canvas{
  width:100%;
  height:100%;
  image-rendering:pixelated;
}

.transition-directional{
  background:#020208;
  overflow:hidden;
}

.transition-directional .frame{
  position:absolute;
  inset:0;
  background-position:center;
  background-size:cover;
  will-change:transform, filter;
}

.transition-directional .frame.after{
  opacity:0;
}

.transition-directional.direction-left .frame.before{
  animation:dirWipeBeforeLeft .9s forwards ease-in;
}

.transition-directional.direction-left .frame.after{
  transform:translateX(100%);
  animation:dirWipeAfterLeft .9s forwards ease-out;
}

.transition-directional.direction-right .frame.before{
  animation:dirWipeBeforeRight .9s forwards ease-in;
}

.transition-directional.direction-right .frame.after{
  transform:translateX(-100%);
  animation:dirWipeAfterRight .9s forwards ease-out;
}

.transition-directional.direction-up .frame.before{
  animation:dirWipeBeforeUp .9s forwards ease-in;
}

.transition-directional.direction-up .frame.after{
  transform:translateY(100%);
  animation:dirWipeAfterUp .9s forwards ease-out;
}

.transition-directional.direction-down .frame.before{
  animation:dirWipeBeforeDown .9s forwards ease-in;
}

.transition-directional.direction-down .frame.after{
  transform:translateY(-100%);
  animation:dirWipeAfterDown .9s forwards ease-out;
}

.transition-directional.direction-diagonal .frame.before{
  animation:dirWipeBeforeDiagonal .9s forwards ease-in;
}

.transition-directional.direction-diagonal .frame.after{
  transform:translate(110%, -110%);
  animation:dirWipeAfterDiagonal .9s forwards ease-out;
}

@keyframes dirWipeBeforeLeft{
  0%{ transform:translateX(0); filter:blur(0px); opacity:1; }
  100%{ transform:translateX(-105%); filter:blur(12px); opacity:0; }
}

@keyframes dirWipeAfterLeft{
  0%{ transform:translateX(105%); filter:blur(12px); opacity:0; }
  45%{ filter:blur(4px); opacity:1; }
  100%{ transform:translateX(0); filter:blur(0px); opacity:1; }
}

@keyframes dirWipeBeforeRight{
  0%{ transform:translateX(0); filter:blur(0px); opacity:1; }
  100%{ transform:translateX(105%); filter:blur(12px); opacity:0; }
}

@keyframes dirWipeAfterRight{
  0%{ transform:translateX(-105%); filter:blur(12px); opacity:0; }
  45%{ filter:blur(4px); opacity:1; }
  100%{ transform:translateX(0); filter:blur(0px); opacity:1; }
}

@keyframes dirWipeBeforeUp{
  0%{ transform:translateY(0); filter:blur(0px); opacity:1; }
  100%{ transform:translateY(-105%); filter:blur(10px); opacity:0; }
}

@keyframes dirWipeAfterUp{
  0%{ transform:translateY(105%); filter:blur(10px); opacity:0; }
  50%{ filter:blur(3px); opacity:1; }
  100%{ transform:translateY(0); filter:blur(0px); opacity:1; }
}

@keyframes dirWipeBeforeDown{
  0%{ transform:translateY(0); filter:blur(0px); opacity:1; }
  100%{ transform:translateY(105%); filter:blur(10px); opacity:0; }
}

@keyframes dirWipeAfterDown{
  0%{ transform:translateY(-105%); filter:blur(10px); opacity:0; }
  50%{ filter:blur(3px); opacity:1; }
  100%{ transform:translateY(0); filter:blur(0px); opacity:1; }
}

@keyframes dirWipeBeforeDiagonal{
  0%{ transform:translate(0,0); filter:blur(0px); opacity:1; }
  100%{ transform:translate(-110%,110%); filter:blur(12px); opacity:0; }
}

@keyframes dirWipeAfterDiagonal{
  0%{ transform:translate(110%,-110%); filter:blur(12px); opacity:0; }
  45%{ filter:blur(5px); opacity:1; }
  100%{ transform:translate(0,0); filter:blur(0px); opacity:1; }
}

.transition-depth{
  background:#020207;
  overflow:hidden;
}

.transition-depth .frame{
  position:absolute;
  inset:-4%;
  background-position:center;
  background-size:cover;
  filter:url(#depth-ripple-filter);
  transform-origin:var(--ripple-x,50%) var(--ripple-y,50%);
  animation:depthRippleFrame 1.4s ease-out forwards;
}

.transition-depth::after{
  content:"";
  position:absolute;
  inset:0;
  background:radial-gradient(circle at var(--ripple-x,50%) var(--ripple-y,50%), rgba(120,170,255,.35) 0%, rgba(50,80,140,.18) 35%, rgba(6,8,25,.6) 68%, rgba(0,0,0,.95) 100%);
  mix-blend-mode:screen;
  opacity:.0;
  animation:depthRippleGlow 1.4s ease-out forwards;
}

@keyframes depthRippleFrame{
  0%{ opacity:1; transform:scale(1); }
  40%{ opacity:.9; transform:scale(1.02); }
  70%{ opacity:.65; transform:scale(1.04); }
  100%{ opacity:0; transform:scale(1.1); }
}

@keyframes depthRippleGlow{
  0%{ opacity:0; }
  25%{ opacity:.55; }
  70%{ opacity:.3; }
  100%{ opacity:0; }
}
